!function(t,i,s){"use strict";function e(i,s){this.element=i,this.settings=t.extend({},n,s),this._defaults=n,this._name=h,this.init()}var h="jigsaw",n={getDataFrom:"html-static",getWidthFrom:"",tile:{},resize:{},resizeIndex:0,loadNumOfTiles:null,animate:!1,classname:"item"};e.prototype={init:function(){this.grid=[],this.tiles=[],this.numOfTiles=0,this.tileCounter=0,this.stopPoint=this.settings.loadNumOfTiles,this.eof=this.settings.loadNumOfTiles,this.startLoop=0,this.lastStopLoopLoaded=0,this.animationCounter=0,this.pageNum=2,this.createBrowserWidthBreakPoints(),this.setupEvents(),this.getDataFrom(this.settings.getDataFrom)},getDataFrom:function(t){switch(t){case"html-paging":case"html-static":this.getTilesDataFromHTML();break;case"json":this.getTileDataFromJSON()}},getTilesDataFromHTML:function(){this.tiles=[];var i=0,s=0,e=0,h=0;for(this.tileElements=t(this.element).children(),this.largestTileWidth=0,i=0;i<this.tileElements.length;i+=1)for(s=0;s<this.settings.tile.length;s+=1)if(t(this.tileElements[i]).hasClass(this.settings.tile[s].classname)){e=this.settings.tile[s].w,h=this.settings.tile[s].h,this.tiles.push(this.tileTemplate(e,h)),this.largestTileWidth=this.largestTileWidth<e?e:this.largestTileWidth;break}this.stopPoint||(this.stopPoint=this.tiles.length,this.eof=this.tiles.length),this.browserResized()},getTileDataFromJSON:function(){var i=this;t.getJSON(this.settings.url[0],function(t){var s,e=0,h=0,n=t.tiles.length,l=0,o=0;for(e=0;n>e;e+=1)for(s=t.tiles[e].tile.classname,h=0;h<i.settings.tile.length;h+=1)s===i.settings.tile[h].classname&&(l=i.settings.tile[h].w,o=i.settings.tile[h].h,i.tiles.push(i.tileTemplate(l,o,s)),i.largestTileWidth=i.largestTileWidth<l?l:i.largestTileWidth);i.eof=i.settings.loadNumOfTiles,i.stopPoint=i.settings.loadNumOfTiles,i.createHTMLElements()}).fail(function(t){console.log("error",t)})},tileOptionGridLock:function(){this.setMinNumOfCols()},tileOptionResize:function(t,i){if("Resize"===this.settings.tileOption){var s=this.getWidth();switch(t){case"html":i>s&&(i=this.settings.tileWidth*this.cols-this.settings.spacing);break;case"grid":this.settings.tileWidth*i>s&&(i=this.shrink(i))}}return i},tileOptionRemove:function(t){var i=!1;return t>=0?"none"!==this.tiles[t].display&&(i=!0):this.removeLargeTiles(),i},getNumberOfTiles:function(){var t=0,i=this.stopPoint,s=0,e=0,h=0;for(t=0;i>t;t+=1)s=this.tiles[t].w,e=this.tiles[t].h,h+=s*e;return h},solveJigsaw:function(t){var i=0;switch(this.numOfTiles=this.getNumberOfTiles(),t){case"moreTiles":console.log("Add more tiles");break;case"browserResize":for(this.startLoop=0,i=0;i<this.tiles.length;i+=1)this.tiles[i].created=!1,this.tiles[i].display="block";this.grid=[]}for(this["tileOption"+this.settings.tileOption](),this.rows=Math.round(this.numOfTiles/this.cols),i=0;i<this.rows;i+=1)this.grid[i]||(this.grid[i]=this.setArrayLength(this.cols));this.build()},removeLargeTiles:function(){var t=this.getWidth(),i=0;for(i=0;i<this.tiles.length;i+=1)this.tiles[i].w*this.settings.tileWidth>t&&(this.tiles[i].display="none")},setMinNumOfCols:function(){var t=this.getWidth(),i=this.largestTileWidth,s=0;for(s=0;i>=s;s+=1)t<this.settings.tileWidth*s&&(this.cols+=1)},build:function(){var t,i=0,s=0,e=0,h=0;for(i=0;i<this.numOfTiles;i+=1){if(t=!0,this.grid[e][s]||(this.tileOptionRemove(h)&&!this.tiles[h].created?this.gridHasSpace(this.tiles[h].w,this.tiles[h].h,e,s)?this.updateGrid(this.tiles[h].w,this.tiles[h].h,e,s):(t=!1,this.searchForTile(h,e,s)):(t=!1,h+=1,this.searchForTile(h,e,s)),t&&(this.updateTile(h,e,s),h+=1)),s<this.cols-1?s+=1:(s=0,e+=1,i<this.numOfTiles-1&&(this.grid[e]||(this.grid[this.grid.length]=this.setArrayLength(this.cols)))),!this.tiles[h]||h===this.stopPoint){this.updateHTMLElements();break}h<this.stopPoint&&i>=this.numOfTiles-1&&(this.grid.length===e&&(this.grid[this.grid.length]=this.setArrayLength(this.cols)),this.numOfTiles+=1)}this.removeEmptyRowsFromGrid()},removeEmptyRowsFromGrid:function(){var t,i,s,e=[];for(t=0;t<this.grid.length;t+=1){for(i=0,s=0;s<this.grid[t].length;s+=1)this.grid[t][s]||(i+=1);i===this.cols&&e.push(t)}for(e.reverse(),t=0;t<e.length;t+=1)this.grid.splice(e[t],1);this.updateElementHeight(this.grid.length*this.settings.tileWidth)},searchForTile:function(t,i,s){var e=t;for(e=t;e<this.stopPoint;e+=1)if(this.tileOptionRemove(e)&&!this.tiles[e].created&&this.gridHasSpace(this.tiles[e].w,this.tiles[e].h,i,s)){this.updateGrid(this.tiles[e].w,this.tiles[e].h,i,s),this.updateTile(e,i,s);break}},isTileCreated:function(t,i,s){var e=!1;return this.tiles[t].w!==i||this.tiles[t].h!==s||this.tiles[t].created||(e=!0),e},updateTile:function(t,i,s){var e=i*this.settings.tileWidth+this.settings.spacing/2,h=s*this.settings.tileWidth+this.settings.spacing/2,n=this.settings.tileWidth*this.tiles[t].w-this.settings.spacing,l=this.settings.tileWidth*this.tiles[t].h-this.settings.spacing;this.tiles[t].created=!0,this.tiles[t].t=e,this.tiles[t].l=h,this.tiles[t].cssWidth=n,this.tiles[t].cssHeight=l,this.tiles[t].created=!0},shrink:function(t){var i=this.getWidth(),s=0,e=t;for(s=0;t>=s;s+=1)i<this.settings.tileWidth*s&&(e-=1);return e},gridHasSpace:function(t,i,s,e){var h=!0,n=0,l=0;for(t=this.tileOptionResize("grid",t),n=0;i>n;n+=1){for(l=0;t>l;l+=1){if(!(e+l<this.cols)){h=!1;break}if(this.grid.length<=s+n&&(this.grid[this.grid.length]=this.setArrayLength(this.cols)),this.grid[s+n][e+l]){h=!1;break}h=!0}if(!h)break}return h},updateGrid:function(t,i,s,e){t=this.tileOptionResize("grid",t);var h=0,n=0;for(h=0;i>h;h+=1)for(n=0;t>n;n+=1)this.grid[s+h][e+n]=1},updateHTMLElements:function(){var i=this.startLoop,s=this.stopPoint,e=0;for(i=this.startLoop;s>i;i+=1)e=this.tileOptionResize("html",this.tiles[i].cssWidth),this.tileElements[i].style.width=e+"px",this.tileElements[i].style.height=this.tiles[i].cssHeight+"px",this.tileElements[i].style.left=this.tiles[i].l+"px",this.tileElements[i].style.top=this.tiles[i].t+"px",this.tileElements[i].style.display=this.tiles[i].display,this.tileElements[i].innerHTML=i,this.settings.animate&&t(this.tileElements[i]).addClass("animate");this.settings.animate&&this.animationController()},animationController:function(){this.animationCounter<this.stopPoint?this.jigsawTimer(1e3/this.settings.animate.frameRate):t(this.tileElements).removeClass("animate start")},addClassToTiles:function(){t(this.tileElements[this.animationCounter]).addClass("start"),this.animationCounter+=1,this.animationController()},jigsawTimer:function(t){clearTimeout(this.jTimer);var i=this;this.jTimer=setTimeout(function(){i.addClassToTiles()},t)},createHTMLElements:function(){var i=this.startLoop,e=this.stopPoint;for(i=this.startLoop;e>i;i+=1){var h=s.createElement("div");h.setAttribute("class",this.settings.classname+" "+this.tiles[i].classname),h.innerHTML=i,this.element.appendChild(h)}this.tileElements=t(this.element).children(),this.browserResized("moreTiles")},setupEvents:function(){this.settings.loadMore&&this.loadMoreButton(),this.settings.scroll&&this.scrollDown()},loadMoreButton:function(){var i=this;t(".load-more").click(function(){i.addMoreTiles()})},scrollDown:function(){var e=this;t(i).scroll(function(){t(i).scrollTop()>=t(s).height()-t(i).height()-10&&e.addMoreTiles()})},tileTemplate:function(t,i,s,e){return{w:t,h:i,t:0,l:0,cssWidth:0,cssHeight:0,classname:s||"",created:!1,display:"block",html:e||""}},setArrayLength:function(t){var i=[],s=0;for(s=0;t>s;s+=1)i[s]=0;return i},getNum:function(t){return Math.floor(Math.random()*t+1)},getWidth:function(){var s;return s=this.settings.getWidthFrom?t(this.settings.getWidthFrom).width():t(i).width(),s=s>this.settings.resize[0].breakpoint?s:this.settings.resize[0].breakpoint},updateElementWidth:function(i){t(this.element)[0].style.width=i+"px"},updateElementHeight:function(i){t(this.element)[0].style.height=i+"px"},consoleLogGrid:function(t){var i=0,s=t.length;for(i=0;s>i;i+=1)console.log(t[i]);console.log("-----------------------------------------------")},addMoreTiles:function(){var i=this;switch(this.settings.getDataFrom){case"html-paging":t.get(this.settings.url+this.pageNum+".html",function(s){t(i.element).append(s),i.getTilesDataFromHTML(),i.startLoop=i.eof,i.stopPoint=i.tiles.length,i.eof=i.tiles.length,i.solveJigsaw("moreTiles"),i.pageNum+=1});break;case"html-static":if(this.stopPoint+this.settings.loadNumOfTiles<this.tiles.length?this.stopPoint+=this.settings.loadNumOfTiles:this.stopPoint=this.tiles.length,this.eof+=this.settings.loadNumOfTiles,this.startLoop=this.lastStopLoopLoaded,!(this.startLoop+this.settings.loadNumOfTiles<this.tiles.length))return this.startLoop=this.tiles.length,void alert("NO MORE TILES");this.startLoop+=this.settings.loadNumOfTiles,this.lastStopLoopLoaded=this.startLoop,this.solveJigsaw("moreTiles");break;case"json":this.stopPoint+this.settings.loadNumOfTiles<this.tiles.length?this.stopPoint+=this.settings.loadNumOfTiles:this.stopPoint=this.tiles.length,this.eof+=this.settings.loadNumOfTiles,this.startLoop=this.lastStopLoopLoaded,this.startLoop+this.settings.loadNumOfTiles<this.tiles.length?this.startLoop+=this.settings.loadNumOfTiles:(this.startLoop=this.tiles.length,alert("NO MORE TILES")),this.lastStopLoopLoaded=this.startLoop,this.createHTMLElements()}},browserResized:function(t){clearInterval(this.interval);var i=this.getWidth(),s=[];this.defineTileProperties(i),s.push(i+1),s.push(i-1),this.updateElementWidth(this.cols*this.settings.tileWidth),this.solveJigsaw(t||"browserResize"),this.listenForBrowserResize(s)},defineTileProperties:function(t){var i=0;for(i=0;i<this.settings.resize.length;i+=1)this.bwbp[i][1]>=t&&this.bwbp[i][0]<t&&(this.settings.resizeIndex=i);this.settings.spacing=this.settings.resize[this.settings.resizeIndex].tileSpace,this.settings.tileWidth=this.settings.resize[this.settings.resizeIndex].tileWidth,this.cols=Math.floor(t/this.settings.tileWidth),this.settings.tileWidth+=Math.floor((t-this.settings.tileWidth*this.cols)/this.cols)},listenForBrowserResize:function(t){var i,s=this;this.interval=setInterval(function(){i=s.getWidth(),t[0]<i?s.browserResized():t[1]>i&&i>s.settings.resize[0].breakpoint&&s.browserResized()},200)},createBrowserWidthBreakPoints:function(){this.bwbp=[];var t=0,i=this.settings.resize.length,s=0,e=0;for(t=0;i>t;t+=1)s=this.settings.resize[t].breakpoint,e=i>t+1?this.settings.resize[t+1].breakpoint-1:3e3,this.bwbp.push([s,e])}},t.fn[h]=function(i){return this.each(function(){t.data(this,"plugin_"+h)||t.data(this,"plugin_"+h,new e(this,i))}),this}}(jQuery,window,document);