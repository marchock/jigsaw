function Jigsaw(e){this.init(e)}function JGSW(e,t){var n={writable:!0,enumerable:!0,configurable:!0,value:t};Object.defineProperty(Jigsaw.prototype,e,n)}Jigsaw.prototype.init=function(e){"use strict";var t=this.Extend(this.Settings(),e);t.stopPoint=t.loadNumOfTiles,t.eof=t.loadNumOfTiles;var n=new this.Utils(t),i=new this.DataController,o=new this.EventsController,s=new this.DataRequest,r=new this.AnimationController(t,n),a=new this.ElementsController(t,n,o,r),l=new this.GridController(t,n,a),u=new this.TileConstructor(t,n,l,a,s,i),c=new this.BreakPoints(t,n,u);o.getMethod(u,"addMore"),o.getMethod(i,"json"),i.init(t,a,u,c,s)},JGSW("AnimationController",function(e,t){"use strict";var n=e,i=t,o=[],s=0;return{start:function(e){o=e,s=n.startLoop,this.loop()},loop:function(){s<n.stopPoint?this.jigsawTimer(1e3/n.animate.frameRate):this.removeClassFromElements()},removeClassFromElements:function(){var e=0,t=n.stopPoint;for(e=n.startLoop;t>e;e+=1)i.removeClass(o[e],"animate start")},addClassToTiles:function(){i.addClass(o[s],"start"),s+=1,this.loop()},jigsawTimer:function(e){clearTimeout(this.jTimer);var t=this;this.jTimer=setTimeout(function(){t.addClassToTiles()},e)}}}),JGSW("BreakPoints",function(e,t,n){"use strict";var i=[],o=e;return function(){var e=0,t=o.resize.length,n=0,s=0;for(e=0;t>e;e+=1)n=o.resize[e].breakpoint,s=t>e+1?o.resize[e+1].breakpoint-1:1e4,i.push([n,s])}(),{browserResize:function(e){clearInterval(this.interval);var s=t.getWidth(),r=[],a=0,l=0;for(a=0;a<o.resize.length;a+=1)i[a][1]>=s&&i[a][0]<s&&(l=a);n.updateSettings(s,l,e),r.push(s+1),r.push(s-1),this.listenForBrowserResize(r)},listenForBrowserResize:function(e){var n,i=this;this.interval=setInterval(function(){n=t.getWidth(),e[0]<=n?i.browserResize():e[1]>=n&&n>=o.resize[0].breakpoint&&i.browserResize()},10)}}}),JGSW("DataController",function(){"use strict";var e,t,n,i,o,s;return{init:function(s,r,a,l,u){switch(e=s,t=r,n=a,i=l,o=u,e.getDataFrom){case"html":case"page":this.html();break;case"json":this.json();break;case"post":}},html:function(){var o=t.getChildren(),s=0,r=o.length,a=[],l="";for("page"===e.getDataFrom&&(e.loadNumOfTiles=r,e.stopPoint=r,e.eof=r),s=0;r>s;s+=1)l=o[s].getAttribute("class"),l=l.replace(e.classnames.tiles,""),l=l.trim(),a.push({classname:l});n.setup(a),i.browserResize()},json:function(){var r=[],a="";if(e.urlEndPoint?(a=e.url+"?"+t.getFormData("serialize"),console.log(a)):a=e.url,e.stopPoint=e.loadNumOfTiles,e.startLoop=0,s){var l=t.getFormData("formInputValues"),u=0,c=0,h=l.length;s.tiles.filter(function(e){for(u=0,c=0;h>c;c+=1)e[l[c].name]===l[c].val&&(u+=1);u===h&&r.push(e)}),l.length<1&&(r=s.tiles),n.setup(r),t.createHTMLElements(r),i.browserResize()}else o.json(a,function(o){s=e.filter?o:s,n.setup(o.tiles),t.createHTMLElements(o.tiles),i.browserResize()})}}}),JGSW("ElementsController",function(e,t,n,i){"use strict";var o,s=e,r=t,a=n,l=i,u=document.querySelector(".jigsaw"),c=u.querySelectorAll("."+s.classnames.tiles),h=document.querySelector(s.classnames.btnLoadMore),d=document.querySelector(s.classnames.formElement);if(s.loadMore&&a.loadMoreBtn(h,"click"),s.filter||s.urlEndPoint){var f=d.elements,p=0,g=f.length-1,m=!1;for(p=g;p>=0;p-=1)m=!1,"INPUT"===f[p].nodeName&&"radio"===f[p].type?m=!0:"SELECT"===f[p].nodeName&&"select-one"===f[p].type&&(m=!0),m&&a.filterGrid(f[p],"change",s.filter)}return{getChildren:function(){return c},updateChildren:function(){c=u.querySelectorAll("."+s.classnames.tiles)},removeChildren:function(){u.innerHTML=""},getFormData:function(e){return r[e](d)},getLength:function(){return c.length},getForm:function(){return d},updateTiles:function(e){var t=0,n=0;for(t=s.startLoop;t<s.stopPoint;t+=1)n=r.tileResize(e[t].cssWidth),c[t].style.width=n+"px",c[t].style.height=e[t].cssHeight+"px",c[t].style.left=e[t].l+"px",c[t].style.top=e[t].t+"px",c[t].style.display=e[t].display,s.animate&&(console.log(t,s.stopPoint),r.addClass(c[t],"animate"));s.animate&&l.start(c)},appendData:function(e){u.innerHTML+=e,this.updateChildren()},updateWidth:function(e){u.style.width=e+"px"},updateHeight:function(e){u.style.height=e+"px"},createHTMLElements:function(e){var t=0;for(e&&(o=e,this.removeChildren()),t=s.startLoop;t<s.stopPoint;t+=1)s.tileTemplate(o[t],u);this.updateChildren()},hide:function(e){switch(e){case"loadMore":s.loadMore&&(h.style.display="none")}},show:function(e){switch(e){case"loadMore":s.loadMore&&(h.style.display="block")}}}}),JGSW("EventsController",function(){"use strict";var e,t;return{getMethod:function(n,i){switch(i){case"addMore":e=n[i];break;case"json":t=n[i]}},loadMoreBtn:function(t,n){t.addEventListener(n,function(){e()})},filterGrid:function(e,n,i){e.addEventListener(n,function(e){var n=0,o=e.target.length,s="";if(i)for(n=0;o>n;n+=1)e.target[n].selected&&(s=e.target[n].value);t(s)})}}}),JGSW("Extend",function(e,t){"use strict";var n=e;return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}),JGSW("GridController",function(e,t,n){"use strict";var i=[],o=e,s=t,r=n;return{resetgrid:function(){i=[]},createRowsAndCols:function(){var e=0;for(e=0;e<o.rows;e+=1)i[e]||(i[e]=s.setArrayLength(o.cols))},spaceAvailable:function(e,t){var n;return n=arguments.length>1?i[e][t]:i[e]},hasSpace:function(e,t,n,r){var a=!0,l=0,u=0;for(l=0;t>l;l+=1){for(u=0;e>u;u+=1){if(!(r+u<o.cols)){a=!1;break}if(i.length<=n+l&&(i[i.length]=s.setArrayLength(o.cols)),i[n+l][r+u]){a=!1;break}a=!0}if(!a)break}return a},update:function(e,t,n,o){var s=0,r=0;for(s=0;t>s;s+=1)for(r=0;e>r;r+=1)i[n+s][o+r]=1},removeEmptyRows:function(){var e,t,n,s=[];for(e=0;e<i.length;e+=1){for(t=0,n=0;n<i[e].length;n+=1)i[e][n]||(t+=1);t===o.cols&&s.push(e)}for(s.reverse(),e=0;e<s.length;e+=1)i.splice(s[e],1);r.updateHeight(i.length*o.tileHeight)},newRow:function(e){i[i.length]=e},getRowLength:function(){return i.length}}}),JGSW("DataRequest",function(){"use strict";var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),{page:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(e.responseText)},e.open("GET",t.page.url+t.page.num+".html",!0),e.send()},json:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(JSON.parse(e.responseText))},e.open("GET",t,!0),e.send()}}}),JGSW("Settings",function(){"use strict";return{classnames:{tiles:"item",formElement:".json-form",btnLoadMore:".load-more"},getDataFrom:"html",url:"",urlEndPoint:!1,filter:!1,loadNumOfTiles:null,getWidthFrom:"",showGutter:!0,page:{url:"",num:1,end:2},tile:[{classname:"smallitem",w:1,h:1},{classname:"largeitem",w:2,h:2},{classname:"longitem",w:2,h:1},{classname:"tallitem",w:1,h:2}],resize:[{breakpoint:320,tileWidth:160,tileHeight:160,tileSpace:8}],animate:!1,scroll:!1,loadMore:!1,cols:0,rows:0,numOfTiles:0,stopPoint:0,eof:0,startLoop:0}}),JGSW("TileConstructor",function(e,t,n,i,o,s){"use strict";var r,a=e,l=t,u=n,c=i,h=o,d=s,f=[];return{setup:function(e){r=this,f=[];var t,n=0,i=0,o=e.length,s=a.tile.length,l=0,u=0;for(a.stopPoint>o?(a.stopPoint=o,"page"!==a.getDataFrom&&c.hide("loadMore")):"page"!==a.getDataFrom&&c.show("loadMore"),n=0;o>n;n+=1)for(t=e[n].classname,i=0;s>i;i+=1)t===a.tile[i].classname&&(l=a.tile[i].w,u=a.tile[i].h,f.push(this.tileTemplate(l,u,t)))},build:function(){var e=0;for(e=0;e<f.length;e+=1)f[e].created=!1,f[e].display="block";u.resetgrid(),this.updateGrid()},updateGrid:function(){a.numOfTiles=l.getNumberOfTiles(a.stopPoint,f),a.rows=Math.round(a.numOfTiles/a.cols),u.createRowsAndCols(),this.jigsawEngine()},jigsawEngine:function(){var e,t=0,n=0,i=0,o=0,s=0,r=0;for(t=0;t<a.numOfTiles;t+=1){if(e=!0,s=this.resize(f[o].w),r=f[o].h,u.spaceAvailable(i,n)||(f[o].created?(e=!1,o+=1,this.searchForTile(o,i,n)):u.hasSpace(s,r,i,n)?u.update(s,r,i,n):(e=!1,this.searchForTile(o,i,n)),e&&(this.updateTile(o,i,n),o+=1)),n<a.cols-1?n+=1:(n=0,i+=1,t<a.numOfTiles-1&&(u.spaceAvailable(i)||u.newRow(l.setArrayLength(a.cols)))),!f[o]||o===a.stopPoint){c.updateTiles(f);break}o<a.stopPoint&&t>=a.numOfTiles-1&&(u.getRowLength()===i&&u.newRow(l.setArrayLength(a.cols)),a.numOfTiles+=1)}u.removeEmptyRows()},resize:function(e){var t=l.getWidth();return a.tileWidth*e>t&&(e=this.shrink(e)),e},searchForTile:function(e,t,n){var i=e,o=0,s=0;for(i=e;i<a.stopPoint;i+=1)if(o=this.resize(f[i].w),s=f[i].h,!f[i].created&&u.hasSpace(o,s,t,n)){u.update(o,s,t,n),this.updateTile(i,t,n);break}},updateSettings:function(e,t,n){a.spacing=a.resize[t].tileSpace,a.tileWidth=a.resize[t].tileWidth,a.tileHeight=a.resize[t].tileHeight,a.cols=Math.floor(e/a.tileWidth),a.tileWidth+=Math.floor((e-a.tileWidth*a.cols)/a.cols),"page"!==a.getDataFrom&&(a.startLoop=0),c.updateWidth(a.cols*a.tileWidth),this.build(n)},updateTile:function(e,t,n){var i=a.showGutter?a.spacing/2:Math.floor(a.spacing/a.cols),o=a.showGutter?a.tileWidth:a.tileWidth+i,s=a.showGutter?a.tileHeight:a.tileHeight+i,r=a.showGutter?t*a.tileHeight+i:t*(a.tileHeight+i),l=a.showGutter?n*a.tileWidth+i:n*(a.tileWidth+i),u=o*f[e].w-a.spacing,c=s*f[e].h-a.spacing;f[e].created=!0,f[e].t=r,f[e].l=l,f[e].cssWidth=u,f[e].cssHeight=c,f[e].created=!0},addMore:function(){switch(a.getDataFrom){case"html":a.stopPoint+a.loadNumOfTiles<f.length?a.stopPoint+=a.loadNumOfTiles:(c.hide("loadMore"),a.stopPoint=f.length),a.startLoop+=a.loadNumOfTiles,r.showMore();break;case"page":a.page.num+=1,h.page(a,function(e){c.appendData(e),a.startLoop=a.stopPoint,a.stopPoint=c.getLength(),a.eof=c.getLength(),a.page.num>=a.page.end&&c.hide("loadMore"),d.html()});break;case"json":a.stopPoint+a.loadNumOfTiles<f.length?a.stopPoint+=a.loadNumOfTiles:(c.hide("loadMore"),a.stopPoint=f.length),a.startLoop+=a.loadNumOfTiles,c.createHTMLElements(),r.showMore()}},tileTemplate:function(e,t,n,i){return{w:e,h:t,t:0,l:0,cssWidth:0,cssHeight:0,classname:n||"",created:!1,display:"block",html:i||""}},getTilesLength:function(){return f.length},update:function(e){f=e,a.stopPoint||(a.stopPoint=f.length,a.eof=f.length)},showMore:function(){this.updateGrid()}}}),JGSW("Utils",function(e){"use strict";var t=e;return{getWidth:function(){var e;return e=this.getComputedStyle(t.getWidthFrom?document.querySelector(t.getWidthFrom):document.getElementsByTagName("body")[0]),e=e>t.resize[0].breakpoint?e:t.resize[0].breakpoint},getComputedStyle:function(e){var t=document.defaultView.getComputedStyle(e,"");return parseInt(t.getPropertyValue("width"),10)},getNumberOfTiles:function(e,t){var n=0,i=0,o=0,s=0;for(n=0;e>n;n+=1)i=t[n].w,o=t[n].h,s+=i*o;return s},setArrayLength:function(e){var t=[],n=0;for(n=0;e>n;n+=1)t[n]=0;return t},tileResize:function(e){var n=this.getWidth();return e>n&&(e=t.tileWidth*t.cols-t.spacing),e},serialize:function(e){var t=[],n=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","hidden"),t=this.getFormData(e,t,"INPUT","radio"),n=0;n<t.length;n+=1)t[n]=t[n].val?t[n].name+"="+encodeURIComponent(t[n].val):"";return t.join("&")},formInputValues:function(e){var t=[],n=[],i=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","radio"),i=0;i<t.length;i+=1)t[i].val&&n.push(t[i]);return n},getFormData:function(e,t,n,i){var o=e.elements,s=0,r=o.length;for(s=r-1;s>=0;s-=1)o[s].nodeName===n&&o[s].type===i&&t.push({name:o[s].name,ele:o[s],val:o[s].value});return t},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}}});