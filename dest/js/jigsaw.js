function Jigsaw(e){this.init(e)}function JGSW(e,t){var n={writable:!0,enumerable:!0,configurable:!0,value:t};Object.defineProperty(Jigsaw.prototype,e,n)}Jigsaw.prototype.init=function(e){"use strict";var t=this.Extend(this.Settings(),e);t.stopPoint=t.load.index,t.eof=t.load.index;var n=new this.Utils(t),i=new this.OptionController,o=new this.EventsController,s=new this.DataRequest,r=new this.AnimationController(t,n),a=new this.ElementsController(t,n,o,r),l=new this.GridController(t,n,a),c=new this.TileConstructor(t,n,l,a,s,i),u=new this.BreakPoints(t,n,c);o.getMethod(c,"addMore"),o.getMethod(i,"json"),i.init(t,a,c,u,s)},JGSW("AnimationController",function(e,t){"use strict";var n=e,i=t,o=[],s=0;return{start:function(e){o=e,s=n.startLoop,this.loop()},loop:function(){s<n.stopPoint?this.jigsawTimer(1e3/n.load.framerate):this.removeClassFromElements()},removeClassFromElements:function(){var e=0,t=n.stopPoint;for(e=n.startLoop;t>e;e+=1)i.removeClass(o[e],"animate start")},addClassToTiles:function(){i.addClass(o[s],"start"),s+=1,this.loop()},jigsawTimer:function(e){clearTimeout(this.jTimer);var t=this;this.jTimer=setTimeout(function(){t.addClassToTiles()},e)}}}),JGSW("BreakPoints",function(e,t,n){"use strict";var i=[],o=e;return function(){var e=0,t=o.breakpoints.length,n=0,s=0;for(e=0;t>e;e+=1)n=o.breakpoints[e].position,s=t>e+1?o.breakpoints[e+1].position-1:1e4,i.push([n,s])}(),{browserResize:function(e){clearInterval(this.interval);var s=t.getWidth(),r=[],a=0,l=0;for(a=0;a<o.breakpoints.length;a+=1)i[a][1]>=s&&i[a][0]<s&&(l=a);n.updateSettings(s,l,e),r.push(s+1),r.push(s-1),this.listenForBrowserResize(r)},listenForBrowserResize:function(e){var n,i=this;this.interval=setInterval(function(){n=t.getWidth(),e[0]<=n?i.browserResize():e[1]>=n&&n>=o.breakpoints[0].position&&i.browserResize()},10)}}}),JGSW("ElementsController",function(e,t,n,i){"use strict";var o,s=e,r=t,a=n,l=i,c=document.querySelector(".jigsaw"),u=c.querySelectorAll("."+s.classnames.tiles),d=document.querySelector(s.classnames.btnLoadMore),h=document.querySelector(s.classnames.formElement);if(s.load.btn&&(a.loadMoreBtn(d,"click"),s.load.animate&&!s.load.framerate&&(s.load.framerate=16)),s.select.filter||s.select.urlEndPoint){var p=h.elements,f=0,g=p.length-1,m=!1;for(f=g;f>=0;f-=1)m=!1,"INPUT"===p[f].nodeName&&"radio"===p[f].type?m=!0:"SELECT"===p[f].nodeName&&"select-one"===p[f].type&&(m=!0),m&&a.filterGrid(p[f],"change",s.select.filter)}return{getChildren:function(){return u},updateChildren:function(){u=c.querySelectorAll("."+s.classnames.tiles)},removeChildren:function(){c.innerHTML=""},getFormData:function(e){return r[e](h)},getLength:function(){return u.length},getForm:function(){return h},updateTiles:function(e){var t=0,n=0;for(t=s.startLoop;t<s.stopPoint;t+=1)n=r.tileResize(e[t].cssWidth),u[t].style.width=n+"px",u[t].style.height=e[t].cssHeight+"px",u[t].style.left=e[t].l+"px",u[t].style.top=e[t].t+"px",u[t].style.display=e[t].display,s.load.animate&&r.addClass(u[t],"animate");s.load.animate&&(l.start(u),s.load.animate=!1)},appendData:function(e){c.innerHTML+=e,this.updateChildren()},updateWidth:function(e){c.style.width=e+"px"},updateHeight:function(e){c.style.height=e+"px"},createHTMLElements:function(e){var t=0;for(e&&(o=e,this.removeChildren()),t=s.startLoop;t<s.stopPoint;t+=1)s.tileTemplate(o[t],c);this.updateChildren()},hide:function(e){switch(e){case"loadMore":s.load.btn&&(d.style.display="none")}},show:function(e){switch(e){case"loadMore":s.load.btn&&(d.style.display="block")}}}}),JGSW("EventsController",function(){"use strict";var e,t;return{getMethod:function(n,i){switch(i){case"addMore":e=n[i];break;case"json":t=n[i]}},loadMoreBtn:function(t,n){t.addEventListener(n,function(){e()})},filterGrid:function(e,n,i){e.addEventListener(n,function(e){var n=0,o=e.target.length,s="";if(i)for(n=0;o>n;n+=1)e.target[n].selected&&(s=e.target[n].value);t(s)})}}}),JGSW("Extend",function(e,t){"use strict";var n=e;return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}),JGSW("GridController",function(e,t,n){"use strict";var i=[],o=e,s=t,r=n;return{resetgrid:function(){i=[]},createRowsAndCols:function(){var e=0;for(e=0;e<o.rows;e+=1)i[e]||(i[e]=s.setArrayLength(o.cols))},spaceAvailable:function(e,t){var n;return n=arguments.length>1?i[e][t]:i[e]},hasSpace:function(e,t,n,r){var a=!0,l=0,c=0;for(l=0;t>l;l+=1){for(c=0;e>c;c+=1){if(!(r+c<o.cols)){a=!1;break}if(i.length<=n+l&&(i[i.length]=s.setArrayLength(o.cols)),i[n+l][r+c]){a=!1;break}a=!0}if(!a)break}return a},update:function(e,t,n,o){var s=0,r=0;for(s=0;t>s;s+=1)for(r=0;e>r;r+=1)i[n+s][o+r]=1},removeEmptyRows:function(){var e,t,n,s=[],a=0;for(e=0;e<i.length;e+=1){for(t=0,n=0;n<i[e].length;n+=1)i[e][n]||(t+=1);t===o.cols&&s.push(e)}for(s.reverse(),e=0;e<s.length;e+=1)i.splice(s[e],1);a=o.showGutter?i.length*o.modifyTileHeight:i.length*o.modifyTileHeight-o.padding,r.updateHeight(a)},newRow:function(e){i[i.length]=e},getRowLength:function(){return i.length}}}),JGSW("OptionController",function(){"use strict";var e,t,n,i,o,s;return{init:function(s,r,a,l,c){switch(e=s,t=r,n=a,i=l,o=c,e.select.option){case"html":case"page":this.html();break;case"json":this.json();break;case"post":}},html:function(){var o=t.getChildren(),s=0,r=o.length,a=[],l="";for("page"===e.select.option&&(e.load.index=r,e.stopPoint=r,e.eof=r),s=0;r>s;s+=1)l=o[s].getAttribute("class"),l=l.replace(e.classnames.tiles,""),l=l.trim(),a.push({classname:l});n.setup(a),i.browserResize()},json:function(){var r=[],a="";if(e.select.urlEndPoint?(a=e.select.url+"?"+t.getFormData("serialize"),console.log(a)):a=e.select.url,e.stopPoint=e.load.index,e.startLoop=0,s){var l=t.getFormData("formInputValues"),c=0,u=0,d=l.length;s.tiles.filter(function(e){for(c=0,u=0;d>u;u+=1)e[l[u].name]===l[u].val&&(c+=1);c===d&&r.push(e)}),l.length<1&&(r=s.tiles),n.setup(r),t.createHTMLElements(r),i.browserResize()}else o.json(a,function(o){s=e.select.filter?o:s,n.setup(o.tiles),t.createHTMLElements(o.tiles),i.browserResize()})}}}),JGSW("DataRequest",function(){"use strict";var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),{page:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(e.responseText)},e.open("GET",t.select.url+t.select.pageIndex+".html",!0),e.send()},json:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(JSON.parse(e.responseText))},e.open("GET",t,!0),e.send()}}}),JGSW("Settings",function(){"use strict";return{showGutter:!1,classnames:{container:".container",tiles:"item",formElement:".json-form",btnLoadMore:".load-more"},select:{option:"HTML",url:"",filter:!1,urlEndPoint:!1,pageIndex:1,pageEnd:2},load:{btn:!1,scroll:!1,index:null,animate:!1,framerate:null},breakpoints:[{position:320,tile:{width:120,height:120,padding:8}}],tile:[{classname:"smallitem",w:1,h:1},{classname:"largeitem",w:2,h:2},{classname:"longitem",w:2,h:1},{classname:"tallitem",w:1,h:2}],modifyTileHeight:0,padding:0,cols:0,rows:0,numOfTiles:0,stopPoint:0,eof:0,startLoop:0}}),JGSW("TileConstructor",function(e,t,n,i,o,s){"use strict";var r,a=e,l=t,c=n,u=i,d=o,h=s,p=[];return{setup:function(e){r=this,p=[];var t,n=0,i=0,o=e.length,s=a.tile.length,l=0,c=0;for(a.stopPoint>o?(a.stopPoint=o,"page"!==a.select.option&&u.hide("loadMore")):"page"!==a.select.option&&u.show("loadMore"),n=0;o>n;n+=1)for(t=e[n].classname,i=0;s>i;i+=1)t===a.tile[i].classname&&(l=a.tile[i].w,c=a.tile[i].h,p.push(this.tileTemplate(l,c,t)))},build:function(){var e=0;for(e=0;e<p.length;e+=1)p[e].created=!1,p[e].display="block";c.resetgrid(),this.updateGrid()},updateGrid:function(){a.numOfTiles=l.getNumberOfTiles(a.stopPoint,p),a.rows=Math.round(a.numOfTiles/a.cols),c.createRowsAndCols(),this.jigsawEngine()},jigsawEngine:function(){var e,t=0,n=0,i=0,o=0,s=0,r=0;for(t=0;t<a.numOfTiles;t+=1){if(e=!0,s=this.resize(p[o].w),r=p[o].h,c.spaceAvailable(i,n)||(p[o].created?(e=!1,o+=1,this.searchForTile(o,i,n)):c.hasSpace(s,r,i,n)?c.update(s,r,i,n):(e=!1,this.searchForTile(o,i,n)),e&&(this.updateTile(o,i,n),o+=1)),n<a.cols-1?n+=1:(n=0,i+=1,t<a.numOfTiles-1&&(c.spaceAvailable(i)||c.newRow(l.setArrayLength(a.cols)))),!p[o]||o===a.stopPoint){u.updateTiles(p);break}o<a.stopPoint&&t>=a.numOfTiles-1&&(c.getRowLength()===i&&c.newRow(l.setArrayLength(a.cols)),a.numOfTiles+=1)}c.removeEmptyRows()},resize:function(e){var t=l.getWidth();return a.tileWidth*e>t&&(e=this.shrink(e)),e},searchForTile:function(e,t,n){var i=e,o=0,s=0;for(i=e;i<a.stopPoint;i+=1)if(o=this.resize(p[i].w),s=p[i].h,!p[i].created&&c.hasSpace(o,s,t,n)){c.update(o,s,t,n),this.updateTile(i,t,n);break}},updateSettings:function(e,t,n){a.padding=a.breakpoints[t].tile.padding,a.tileWidth=a.breakpoints[t].tile.width,a.tileHeight=a.breakpoints[t].tile.height,a.cols=Math.floor(e/a.tileWidth),a.tileWidth+=Math.floor((e-a.tileWidth*a.cols)/a.cols),"page"!==a.select.option&&(a.startLoop=0),u.updateWidth(a.cols*a.tileWidth),this.build(n)},updateTile:function(e,t,n){var i=a.showGutter?a.padding/2:a.padding/a.cols,o=a.showGutter?a.tileWidth:a.tileWidth+i,s=a.showGutter?a.tileHeight:a.tileHeight+i,r=a.showGutter?t*a.tileHeight+i:t*(a.tileHeight+i),l=a.showGutter?n*a.tileWidth+i:n*(a.tileWidth+i),c=o*p[e].w-a.padding,u=s*p[e].h-a.padding;a.modifyTileHeight=s,p[e].created=!0,p[e].t=r,p[e].l=l,p[e].cssWidth=c,p[e].cssHeight=u,p[e].created=!0},addMore:function(){switch(a.load.framerate&&(a.load.animate=!0),a.select.option){case"html":a.stopPoint+a.load.index<p.length?a.stopPoint+=a.load.index:(u.hide("loadMore"),a.stopPoint=p.length),a.startLoop+=a.load.index,r.showMore();break;case"page":a.select.pageIndex+=1,d.page(a,function(e){u.appendData(e),a.startLoop=a.stopPoint,a.stopPoint=u.getLength(),a.eof=u.getLength(),a.select.pageIndex>=a.select.pageEnd&&u.hide("loadMore"),h.html()});break;case"json":a.stopPoint+a.load.index<p.length?a.stopPoint+=a.load.index:(u.hide("loadMore"),a.stopPoint=p.length),a.startLoop+=a.load.index,u.createHTMLElements(),r.showMore()}},tileTemplate:function(e,t,n,i){return{w:e,h:t,t:0,l:0,cssWidth:0,cssHeight:0,classname:n||"",created:!1,display:"block",html:i||""}},getTilesLength:function(){return p.length},update:function(e){p=e,a.stopPoint||(a.stopPoint=p.length,a.eof=p.length)},showMore:function(){this.updateGrid()}}}),JGSW("Utils",function(e){"use strict";var t=e;return{getWidth:function(){var e;return e=this.getComputedStyle(t.classnames.container?document.querySelector(t.classnames.container):document.getElementsByTagName("body")[0]),e=e>t.breakpoints[0].position?e:t.breakpoints[0].position},getComputedStyle:function(e){var t=document.defaultView.getComputedStyle(e,"");return parseInt(t.getPropertyValue("width"),10)},getNumberOfTiles:function(e,t){var n=0,i=0,o=0,s=0;for(n=0;e>n;n+=1)i=t[n].w,o=t[n].h,s+=i*o;return s},setArrayLength:function(e){var t=[],n=0;for(n=0;e>n;n+=1)t[n]=0;return t},tileResize:function(e){var n=this.getWidth();return e>n&&(e=t.tileWidth*t.cols-t.padding),e},serialize:function(e){var t=[],n=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","hidden"),t=this.getFormData(e,t,"INPUT","radio"),n=0;n<t.length;n+=1)t[n]=t[n].val?t[n].name+"="+encodeURIComponent(t[n].val):"";return t.join("&")},formInputValues:function(e){var t=[],n=[],i=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","radio"),i=0;i<t.length;i+=1)t[i].val&&n.push(t[i]);return n},getFormData:function(e,t,n,i){var o=e.elements,s=0,r=o.length;for(s=r-1;s>=0;s-=1)o[s].nodeName===n&&o[s].type===i&&t.push({name:o[s].name,ele:o[s],val:o[s].value});return t},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}}});