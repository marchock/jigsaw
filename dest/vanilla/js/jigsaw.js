function Jigsaw(e){this.init(e)}function JGSW(e,t){var n={writable:!0,enumerable:!0,configurable:!0,value:t};Object.defineProperty(Jigsaw.prototype,e,n)}Jigsaw.prototype.init=function(e){"use strict";var t=this.Extend(this.Settings(),e);t.stopPoint=t.loadNumOfTiles,t.eof=t.loadNumOfTiles;var n=new this.Utils(t),i=new this.DataController,o=new this.EventsController,r=new this.DataRequest,s=new this.ElementsController(t,n,o),a=new this.GridController(t,n,s),l=new this.TileConstructor(t,n,a,s,r,i),u=new this.BreakPoints(t,n,l);o.getMethod(l,"addMore"),o.getMethod(i,"json"),i.init(t,s,l,u,r)},JGSW("BreakPoints",function(e,t,n){"use strict";var i=[],o=e;return function(){var e=0,t=o.resize.length,n=0,r=0;for(e=0;t>e;e+=1)n=o.resize[e].breakpoint,r=t>e+1?o.resize[e+1].breakpoint-1:1e4,i.push([n,r])}(),{browserResize:function(e){clearInterval(this.interval);var r=t.getWidth(),s=[],a=0,l=0;for(a=0;a<o.resize.length;a+=1)i[a][1]>=r&&i[a][0]<r&&(l=a);n.updateSettings(r,l,e),s.push(r+1),s.push(r-1),this.listenForBrowserResize(s)},listenForBrowserResize:function(e){var n,i=this;this.interval=setInterval(function(){n=t.getWidth(),e[0]<=n?i.browserResize():e[1]>=n&&n>=o.resize[0].breakpoint&&i.browserResize()},10)}}}),JGSW("DataController",function(){"use strict";var e,t,n,i,o,r;return{init:function(r,s,a,l,u){switch(e=r,t=s,n=a,i=l,o=u,e.getDataFrom){case"html":case"page":this.html();break;case"json":this.json();break;case"post":}},html:function(){var o=t.getChildren(),r=0,s=o.length,a=[],l="";for(r=0;s>r;r+=1)l=o[r].getAttribute("class"),l=l.replace(e.classnames.tiles,""),l=l.trim(),a.push({classname:l});n.setup(a),i.browserResize()},json:function(){var s=[],a="";if(e.urlEndPoint?(a=e.url+"?"+t.getFormData("serialize"),console.log(a)):a=e.url,e.stopPoint=e.loadNumOfTiles,e.startLoop=0,r){var l=t.getFormData("formInputValues"),u=0,c=0,h=l.length;r.tiles.filter(function(e){for(u=0,c=0;h>c;c+=1)e[l[c].name]===l[c].val&&(u+=1);u===h&&s.push(e)}),l.length<1&&(s=r.tiles),n.setup(s),t.createHTMLElements(s),i.browserResize()}else o.json(a,function(o){r=e.filter?o:r,n.setup(o.tiles),t.createHTMLElements(o.tiles),i.browserResize()})}}}),JGSW("ElementsController",function(e,t,n){"use strict";var i,o=e,r=t,s=n,a=document.querySelector(".jigsaw"),l=a.querySelectorAll("."+o.classnames.tiles),u=document.querySelector(o.classnames.btnLoadMore),c=document.querySelector(o.classnames.formElement);if(o.loadMore&&s.loadMoreBtn(u,"click"),o.filter||o.urlEndPoint){var h=c.elements,d=0,f=h.length-1,p=!1;for(d=f;d>=0;d-=1)p=!1,"INPUT"===h[d].nodeName&&"radio"===h[d].type?p=!0:"SELECT"===h[d].nodeName&&"select-one"===h[d].type&&(p=!0),p&&s.filterGrid(h[d],"change",o.filter)}return{getChildren:function(){return l},updateChildren:function(){l=a.querySelectorAll("."+o.classnames.tiles)},removeChildren:function(){a.innerHTML=""},getFormData:function(e){return r[e](c)},getLength:function(){return l.length},getForm:function(){return c},updateTiles:function(e){var t=0,n=0;for(t=o.startLoop;t<o.stopPoint;t+=1)n=r.tileResize(e[t].cssWidth),l[t].style.width=n+"px",l[t].style.height=e[t].cssHeight+"px",l[t].style.left=e[t].l+"px",l[t].style.top=e[t].t+"px",l[t].style.display=e[t].display},appendData:function(e){a.innerHTML+=e,this.updateChildren()},updateWidth:function(e){a.style.width=e+"px"},updateHeight:function(e){a.style.height=e+"px"},createHTMLElements:function(e){var t=0;for(e&&(i=e,this.removeChildren()),t=o.startLoop;t<o.stopPoint;t+=1)o.tileTemplate(i[t],a);this.updateChildren()},hide:function(e){switch(e){case"loadMore":u.style.display="none"}},show:function(e){switch(e){case"loadMore":u.style.display="block"}}}}),JGSW("EventsController",function(){"use strict";var e,t;return{getMethod:function(n,i){switch(i){case"addMore":e=n[i];break;case"json":t=n[i]}},loadMoreBtn:function(t,n){t.addEventListener(n,function(){e()})},filterGrid:function(e,n,i){e.addEventListener(n,function(e){var n=0,o=e.target.length,r="";if(i)for(n=0;o>n;n+=1)e.target[n].selected&&(r=e.target[n].value);t(r)})}}}),JGSW("Extend",function(e,t){"use strict";var n=e;return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}),JGSW("GridController",function(e,t,n){"use strict";var i=[],o=e,r=t,s=n;return{resetgrid:function(){i=[]},createRowsAndCols:function(){var e=0;for(e=0;e<o.rows;e+=1)i[e]||(i[e]=r.setArrayLength(o.cols))},spaceAvailable:function(e,t){var n;return n=arguments.length>1?i[e][t]:i[e]},hasSpace:function(e,t,n,s){var a=!0,l=0,u=0;for(l=0;t>l;l+=1){for(u=0;e>u;u+=1){if(!(s+u<o.cols)){a=!1;break}if(i.length<=n+l&&(i[i.length]=r.setArrayLength(o.cols)),i[n+l][s+u]){a=!1;break}a=!0}if(!a)break}return a},update:function(e,t,n,o){var r=0,s=0;for(r=0;t>r;r+=1)for(s=0;e>s;s+=1)i[n+r][o+s]=1},removeEmptyRows:function(){var e,t,n,r=[];for(e=0;e<i.length;e+=1){for(t=0,n=0;n<i[e].length;n+=1)i[e][n]||(t+=1);t===o.cols&&r.push(e)}for(r.reverse(),e=0;e<r.length;e+=1)i.splice(r[e],1);s.updateHeight(i.length*o.tileHeight)},newRow:function(e){i[i.length]=e},getRowLength:function(){return i.length}}}),JGSW("DataRequest",function(){"use strict";var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),{page:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(e.responseText)},e.open("GET",t.page.url+t.page.num+".html",!0),e.send()},json:function(t,n){e.onreadystatechange=function(){4===e.readyState&&200===e.status&&n(JSON.parse(e.responseText))},e.open("GET",t,!0),e.send()}}}),JGSW("Settings",function(){"use strict";return{classnames:{tiles:"item",formElement:".json-form",btnLoadMore:".load-more"},getDataFrom:"html-static",url:"",urlEndPoint:!1,filter:!1,loadNumOfTiles:null,getWidthFrom:"",showGutter:!0,page:{url:"",num:1,end:2},tile:[{classname:"smallitem",w:1,h:1},{classname:"largeitem",w:2,h:2},{classname:"longitem",w:2,h:1},{classname:"tallitem",w:1,h:2}],resize:[{breakpoint:320,tileWidth:160,tileHeight:160,tileSpace:8}],animate:!1,scroll:!1,loadMore:!1,cols:0,rows:0,numOfTiles:0,stopPoint:0,eof:0,startLoop:0}}),JGSW("TileConstructor",function(e,t,n,i,o,r){"use strict";var s,a=e,l=t,u=n,c=i,h=o,d=r,f=[];return{setup:function(e){s=this,f=[];var t,n=0,i=0,o=e.length,r=a.tile.length,l=0,u=0;for(a.stopPoint>o?(a.stopPoint=o,"page"!==a.getDataFrom&&c.hide("loadMore")):"page"!==a.getDataFrom&&c.show("loadMore"),n=0;o>n;n+=1)for(t=e[n].classname,i=0;r>i;i+=1)t===a.tile[i].classname&&(l=a.tile[i].w,u=a.tile[i].h,f.push(this.tileTemplate(l,u,t)))},build:function(){var e=0;for(e=0;e<f.length;e+=1)f[e].created=!1,f[e].display="block";u.resetgrid(),a.startLoop=0,this.updateGrid()},updateGrid:function(){a.numOfTiles=l.getNumberOfTiles(a.stopPoint,f),a.rows=Math.round(a.numOfTiles/a.cols),u.createRowsAndCols(),this.jigsawEngine()},jigsawEngine:function(){var e,t=0,n=0,i=0,o=0,r=0,s=0;for(t=0;t<a.numOfTiles;t+=1){if(e=!0,r=this.resize(f[o].w),s=f[o].h,u.spaceAvailable(i,n)||(f[o].created?(e=!1,o+=1,this.searchForTile(o,i,n)):u.hasSpace(r,s,i,n)?u.update(r,s,i,n):(e=!1,this.searchForTile(o,i,n)),e&&(this.updateTile(o,i,n),o+=1)),n<a.cols-1?n+=1:(n=0,i+=1,t<a.numOfTiles-1&&(u.spaceAvailable(i)||u.newRow(l.setArrayLength(a.cols)))),!f[o]||o===a.stopPoint){c.updateTiles(f);break}o<a.stopPoint&&t>=a.numOfTiles-1&&(u.getRowLength()===i&&u.newRow(l.setArrayLength(a.cols)),a.numOfTiles+=1)}u.removeEmptyRows()},resize:function(e){var t=l.getWidth();return a.tileWidth*e>t&&(e=this.shrink(e)),e},searchForTile:function(e,t,n){var i=e,o=0,r=0;for(i=e;i<a.stopPoint;i+=1)if(o=this.resize(f[i].w),r=f[i].h,!f[i].created&&u.hasSpace(o,r,t,n)){u.update(o,r,t,n),this.updateTile(i,t,n);break}},updateSettings:function(e,t,n){a.spacing=a.resize[t].tileSpace,a.tileWidth=a.resize[t].tileWidth,a.tileHeight=a.resize[t].tileHeight,a.cols=Math.floor(e/a.tileWidth),a.tileWidth+=Math.floor((e-a.tileWidth*a.cols)/a.cols),a.startLoop=0,c.updateWidth(a.cols*a.tileWidth),this.build(n)},updateTile:function(e,t,n){var i=a.showGutter?a.spacing/2:Math.floor(a.spacing/a.cols),o=a.showGutter?a.tileWidth:a.tileWidth+i,r=a.showGutter?a.tileHeight:a.tileHeight+i,s=a.showGutter?t*a.tileHeight+i:t*(a.tileHeight+i),l=a.showGutter?n*a.tileWidth+i:n*(a.tileWidth+i),u=o*f[e].w-a.spacing,c=r*f[e].h-a.spacing;f[e].created=!0,f[e].t=s,f[e].l=l,f[e].cssWidth=u,f[e].cssHeight=c,f[e].created=!0},addMore:function(){switch(a.getDataFrom){case"html":a.stopPoint+a.loadNumOfTiles<f.length?a.stopPoint+=a.loadNumOfTiles:(c.hide("loadMore"),a.stopPoint=f.length),a.startLoop+=a.loadNumOfTiles,s.showMore();break;case"page":a.page.num+=1,h.page(a,function(e){c.appendData(e),a.startLoop=a.eof,a.stopPoint=c.getLength(),a.eof=c.getLength(),a.page.num>=a.page.end&&c.hide("loadMore"),d.html()});break;case"json":a.stopPoint+a.loadNumOfTiles<f.length?a.stopPoint+=a.loadNumOfTiles:(c.hide("loadMore"),a.stopPoint=f.length),a.startLoop+=a.loadNumOfTiles,c.createHTMLElements(),s.showMore()}},tileTemplate:function(e,t,n,i){return{w:e,h:t,t:0,l:0,cssWidth:0,cssHeight:0,classname:n||"",created:!1,display:"block",html:i||""}},getTilesLength:function(){return f.length},update:function(e){f=e,a.stopPoint||(a.stopPoint=f.length,a.eof=f.length)},showMore:function(){this.updateGrid()}}}),JGSW("Utils",function(e){"use strict";var t=e;return{getWidth:function(){var e;return e=this.getComputedStyle(t.getWidthFrom?document.querySelector(t.getWidthFrom):document.getElementsByTagName("body")[0]),e=e>t.resize[0].breakpoint?e:t.resize[0].breakpoint},getComputedStyle:function(e){var t=document.defaultView.getComputedStyle(e,"");return parseInt(t.getPropertyValue("width"),10)},getNumberOfTiles:function(e,t){var n=0,i=0,o=0,r=0;for(n=0;e>n;n+=1)i=t[n].w,o=t[n].h,r+=i*o;return r},setArrayLength:function(e){var t=[],n=0;for(n=0;e>n;n+=1)t[n]=0;return t},tileResize:function(e){var n=this.getWidth();return e>n&&(e=t.tileWidth*t.cols-t.spacing),e},serialize:function(e){var t=[],n=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","hidden"),t=this.getFormData(e,t,"INPUT","radio"),n=0;n<t.length;n+=1)t[n]=t[n].val?t[n].name+"="+encodeURIComponent(t[n].val):"";return t.join("&")},formInputValues:function(e){var t=[],n=[],i=0;for(t=this.getFormData(e,t,"SELECT","select-one"),t=this.getFormData(e,t,"INPUT","radio"),i=0;i<t.length;i+=1)t[i].val&&n.push(t[i]);return n},getFormData:function(e,t,n,i){var o=e.elements,r=0,s=o.length;for(r=s-1;r>=0;r-=1)o[r].nodeName===n&&o[r].type===i&&t.push({name:o[r].name,ele:o[r],val:o[r].value});return t}}});